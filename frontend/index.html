<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A tool to analyze █████████ text by highlighting important words and phrases.">
    <meta name="keywords" content="redact, text analysis, privacy, redaction tool, ██████████, text highlighter">
    <meta name="author" content="██████ ███">
    <meta name="robots" content="index, follow">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect x='0' y='2' width='20' height='7'/><rect x='22' y='2' width='10' height='7'/><rect x='0' y='11' width='7' height='7'/><rect x='9' y='11' width='17' height='7'/><rect x='0' y='20' width='10' height='7'/><rect x='12' y='20' width='17' height='7'/></svg>">
    <title>Redac&apos;t</title>
    <style>
        @font-face {
            font-family: 'Source Sans Pro';
            src: url('/static/fonts/SourceSansPro-Regular.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        @font-face {
            font-family: 'Source Sans Pro';
            src: url('/static/fonts/SourceSansPro-Bold.ttf') format('truetype');
            font-weight: bold;
            font-style: normal;
            font-display: swap;
        }

        @font-face {
            font-family: 'Source Code Pro';
            src: url('/static/fonts/SourceCodePro-Regular.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        @font-face {
            font-family: 'Source Code Pro';
            src: url('/static/fonts/SourceCodePro-Bold.ttf') format('truetype');
            font-weight: bold;
            font-style: normal;
            font-display: swap;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @media (prefers-color-scheme: dark) {
            body {
                background-color: #222;
                color: #eee;
            }

            header {
                background-color: #0D1A2b;
                color: #eee;
            }

            footer {
                background-color: #0D1A2b;
                color: #eee;
            }

            #editor {
                color: #eee;
                caret-color: #eee;
            }

            #editor-wrapper {
                background-color: #070f18;
            }

            #highlighter span {
                opacity: 0.7;
            }
        }

        @media (prefers-color-scheme: light) {
            body {
                background-color: white;
                color: #111;
            }

            header {
                background-color: #14315b;
                color: white;
            }

            footer {
                background-color: #14315b;
                color: white;
            }

            #editor {
                color: black;
                caret-color: black;
            }

            #editor-wrapper {
                background-color: white;
            }
        }

        body {
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
            font-family: 'Source Sans Pro', Arial, sans-serif;
        }

        h1 {
            font-size: 24px;
        }

        header {
            padding: 10px;
            text-align: center;
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        main {
            flex: 1;
            display: flex;
            gap: 0;
            overflow-y: auto;
        }

        #editor-wrapper {
            position: relative;
            flex: 1;
            height: 100%;
            overflow-y: auto;
        }

        .container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            min-height: 100%;
            padding: 15px;
            margin: 0;
            font-family: 'Source Code Pro', monospace;
            font-size: 16px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            border: none;
        }

        #editor {
            z-index: 2;
            background: transparent;
            outline: none;
        }

        #highlighter {
            z-index: 1;
            color: transparent;
            user-select: none;
            pointer-events: none;
        }

        #highlighter span {
            color: transparent;
            border-radius: 2px;
            transition: background-color 0.3s ease, opacity 0.3s ease;
        }

        .controls {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            align-items: center;
            gap: 10px;
        }

        .controls>div {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 5px;
        }

        footer {
            font-size: smaller;
            padding: 10px;
            text-align: center;
        }

        select {
            padding: 5px;
        }

        .loader-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loader-dots {
            display: flex;
            gap: 10px;
        }

        .loader-dots span {
            width: 16px;
            height: 16px;
            background: #64a4ff;
            border-radius: 50%;
            animation: bounce 0.3s ease-in-out infinite alternate;
        }

        .loader-dots span:nth-child(2) {
            animation-delay: 0.1s;
        }

        .loader-dots span:nth-child(3) {
            animation-delay: 0.2s;
        }

        @keyframes bounce {
            from {
                transform: translateY(0);
                opacity: 1;
            }
            to {
                transform: translateY(-22px);
                opacity: 0.4;
            }
        }
    </style>
</head>

<body>
    <div class="loader-overlay">
        <div class="loader-dots">
            <span></span><span></span><span></span>
        </div>
    </div>
    <header>
        <h1>Redac&apos;t</h1>
        <div><span id="health-indicator"></span></div>
        <div class="controls">
            <select id="model-select" title="Select model">
                <option value="">Loading models &hellip;</option>
            </select>
            <datalist id="steplist">
                <option value="0"></option>
                <option value="40"></option>
                <option value="70"></option>
                <option value="90"></option>
                <option value="100"></option>
            </datalist>
            <div>
                <label for="single-level">Word</label>
                <input type="range" id="single-level" min="0" max="4" step="1" list="steplist">
            </div>
            <div>
                <label for="phrase-level">Phrase</label>
                <input type="range" id="phrase-level" min="0" max="4" step="1" list="steplist">
            </div>
            <button id="download-redacted" title="Download Redacted Text"
                style="background: none; border: none; cursor: pointer; color: white; vertical-align: middle; padding: 0 10px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
            </button>
        </div>
    </header>

    <main>
        <div id="editor-wrapper">
            <div id="highlighter" class="container"></div>
            <div id="editor" class="container" contenteditable="true" spellcheck="false"></div>
        </div>
    </main>

    <footer>
        <p>&copy; 2026 ███████. All rights reserved.</p>
    </footer>
</body>

<script>
    (function (window) {
        // container for DOM elements of interest
        const el = {};
        const API_VERSION = 'v1';
        const HEALTH_ENDPOINT = `/api/${API_VERSION}/health`;
        const ANALYZE_ENDPOINT = `/api/${API_VERSION}/analyze`;
        const REDACT_ENDPOINT = `/api/${API_VERSION}/redact`;

        let analysisTimeout;

        function escapeHtml(text) {
            return text
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;');
        }

        async function downloadRedactedText() {
            const editor = document.getElementById('editor');
            const text = editor.innerText;
            if (!text.trim())
                return;
            const datalistOptions = Array.from(document.querySelectorAll('#steplist option')).map(opt => parseInt(opt.value));
            const phraseValue = datalistOptions[document.getElementById('phrase-level').value];
            const singleValue = datalistOptions[document.getElementById('single-level').value];
            const modes = [];
            if (phraseValue > 0)
                modes.push({ type: 'phrase', level: phraseValue });
            if (singleValue > 0)
                modes.push({ type: 'single', level: singleValue });
            try {
                showLoader();
                const response = await fetch(REDACT_ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        text: text,
                        modes: modes,
                        model: el.modelSelect.value,
                    })
                });
                const data = await response.json();
                const blob = new Blob([data.redacted_text], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, 19);
                a.href = url;
                a.download = `redacted_final_${timestamp}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
            catch (error) {
                console.error('Download failed:', error);
            }
            finally {
                hideLoader();
            }
        }

        async function analyzeText() {
            if (!el.editor || el.editor.innerText.length === 0)
                return;
            const modes = [];
            const datalistOptions = Array.from(document.querySelectorAll('#steplist option')).map(opt => parseInt(opt.value));
            const phraseLevel = parseInt(document.getElementById('phrase-level').value);
            const phraseValue = datalistOptions[phraseLevel];
            if (phraseValue > 0) {
                modes.push({
                    type: 'phrase',
                    level: phraseValue,
                });
            }
            const singleLevel = parseInt(document.getElementById('single-level').value);
            const singleValue = datalistOptions[singleLevel];
            if (singleValue > 0) {
                modes.push({
                    type: 'single',
                    level: singleValue,
                });
            }
            const originalText = el.editor.innerText.replace(/\r\n/g, '\n');
            try {
                showLoader();
                const response = await fetch(ANALYZE_ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        text: originalText,
                        modes: modes,
                        model: el.modelSelect.value,
                    })
                });
                const data = await response.json();
                let html = '';
                let cursor = 0;
                for (const [start, end, importance] of data.analysis) {
                    if (start > cursor) {
                        html += escapeHtml(originalText.slice(cursor, start));
                    }
                    const hue = (1 - importance) * 120;
                    html += `<span style="background-color: hsla(${hue.toFixed(0)}, 80%, 50%, 0.8);">${escapeHtml(originalText.slice(start, end))}</span>`;
                    cursor = end;
                }
                if (cursor < originalText.length) {
                    html += escapeHtml(originalText.slice(cursor));
                }

                el.highlighter.innerHTML = html.replace(/\n/g, '<br>');
            }
            catch (error) {
                console.error('Analysis failed:', error);
            }
            finally {
                hideLoader();
            }
        }

        function onInput() {
            if (!analysisTimeout) {
                analyzeText();
            }
            clearTimeout(analysisTimeout);
            analysisTimeout = setTimeout(() => {
                localStorage.setItem('editorContent', el.editor.innerText);
                analyzeText();
            }, 400);
        }

        function onSliderChange() {
            localStorage.setItem('phraseLevel', el.phraseSlider.value);
            localStorage.setItem('singleLevel', el.singleSlider.value);
            analyzeText();
        }

        function onModelChange() {
            localStorage.setItem('selectedModel', el.modelSelect.value);
            analyzeText();
        }

        function showLoader() {
            el.loaderOverlay.style.display = 'flex';
        }

        function hideLoader() {
            el.loaderOverlay.style.display = 'none';
        }

        async function checkHealth() {
            try {
                const response = await fetch(HEALTH_ENDPOINT);
                const data = await response.json();
                if (data.status !== 'healthy') {
                    console.error('Backend not reachable. Please try again later.');
                    el.modelSelect.innerHTML = '<option value="">Backend not reachable</option>';
                    return;
                }
                el.modelSelect.innerHTML = '';
                data.models.forEach(model => {
                    const option = document.createElement('option');
                    option.value = model;
                    option.textContent = model;
                    el.modelSelect.appendChild(option);
                });
                const savedModel = localStorage.getItem('selectedModel');
                if (savedModel && data.models.includes(savedModel)) {
                    el.modelSelect.value = savedModel;
                    analyzeText();
                }
            }
            catch (error) {
                console.error('Health check failed:', error);
                el.modelSelect.innerHTML = '<option value="">Backend not reachable</option>';
            }
            finally {
                hideLoader();
            }
        }

        function setup() {
            el.modelSelect = document.getElementById('model-select');
            el.modelSelect.addEventListener('change', onModelChange);
            el.highlighter = document.getElementById('highlighter');
            el.editor = document.getElementById('editor');
            el.editor.innerText = localStorage.getItem('editorContent') || '';
            el.editor.addEventListener('input', onInput);
            el.editor.addEventListener('paste', e => {
                e.preventDefault();
                const text = (e.originalEvent || e).clipboardData.getData('text/plain');
                document.execCommand('insertText', false, text);
            });
            el.editor.addEventListener('scroll', () => {
                el.highlighter.scrollTop = el.editor.scrollTop;
            });
            el.phraseSlider = document.getElementById('phrase-level');
            el.phraseSlider.addEventListener('input', onSliderChange);
            el.phraseSlider.value = localStorage.getItem('phraseLevel') || el.phraseSlider.value;
            el.singleSlider = document.getElementById('single-level');
            el.singleSlider.addEventListener('input', onSliderChange);
            el.singleSlider.value = localStorage.getItem('singleLevel') || el.singleSlider.value;
            el.loaderOverlay = document.querySelector('.loader-overlay');
            document.getElementById('download-redacted').addEventListener('click', downloadRedactedText);
            checkHealth().then(() => {
                analyzeText();
            })
                .catch(error => {
                    console.error('Setup failed:', error);
                });
        }

        document.addEventListener('DOMContentLoaded', setup);
    })(window);
</script>

</html>